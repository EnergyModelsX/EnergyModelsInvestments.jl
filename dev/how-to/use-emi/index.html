<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Use EMI Â· EnergyModelsInvestments</title><meta name="title" content="Use EMI Â· EnergyModelsInvestments"/><meta property="og:title" content="Use EMI Â· EnergyModelsInvestments"/><meta property="twitter:title" content="Use EMI Â· EnergyModelsInvestments"/><meta name="description" content="Documentation for EnergyModelsInvestments."/><meta property="og:description" content="Documentation for EnergyModelsInvestments."/><meta property="twitter:description" content="Documentation for EnergyModelsInvestments."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">EnergyModelsInvestments</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/quick-start/">Quick Start</a></li><li><a class="tocitem" href="../../manual/philosophy/">Philosophy</a></li><li><a class="tocitem" href="../../manual/optimization-variables/">Optimization variables</a></li><li><a class="tocitem" href="../../manual/simple-example/">Example</a></li><li><a class="tocitem" href="../../manual/NEWS/">Release notes</a></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../update-models/">Update models</a></li><li class="is-active"><a class="tocitem" href>Use EMI</a><ul class="internal"><li><a class="tocitem" href="#how_to-use_emi-aux_fun"><span>Auxiliary functions</span></a></li><li><a class="tocitem" href="#how_to-use_emi-var_dec"><span>Variable declarations</span></a></li><li><a class="tocitem" href="#how_to-use_emi-inc_inv"><span>Inclusion of investment constraints</span></a></li><li><a class="tocitem" href="#how_to-use_emi-up_obj"><span>Updating the objective function</span></a></li></ul></li><li><a class="tocitem" href="../contribute/">Contribute to EnergyModelsInvestments</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/public/">Public</a></li><li><a class="tocitem" href="../../library/internals/">Internals</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to</a></li><li class="is-active"><a href>Use EMI</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Use EMI</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsInvestments.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsInvestments.jl/blob/main/docs/src/how-to/use-emi.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="how_to-use_emi"><a class="docs-heading-anchor" href="#how_to-use_emi">Use <code>EnergyModelsInvestments</code></a><a id="how_to-use_emi-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-use_emi" title="Permalink"></a></h1><p><code>EnergyModelsInvestments</code> was initially designed as extension package for <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/"><code>EnergyModelsBase</code></a>. Hence, many design choices are impacted by the requirements of <code>EnergyModelsBase</code>. We realized however that it can be beneficial to make it independent of <code>EnergyModelsBase</code> to use the incorporated methods in other energy system optimization models that may be under development.</p><p>Using <code>EnergyModelsInvestments</code> requires the following implementations in your model.</p><div class="admonition is-success"><header class="admonition-header">Implementation</header><div class="admonition-body"><p>If you are uncertain on how to best implement investment options, it can be beneficial to investigate the approaches chosen in <a href="https://github.com/EnergyModelsX/EnergyModelsBase.jl/tree/main/ext/EMIExt"><code>EnergyModelsBase</code></a> and <a href="https://github.com/EnergyModelsX/EnergyModelsGeography.jl/tree/main/ext/EMIExt"><code>EnergyModelsGeography</code></a>.</p></div></div><h2 id="how_to-use_emi-aux_fun"><a class="docs-heading-anchor" href="#how_to-use_emi-aux_fun">Auxiliary functions</a><a id="how_to-use_emi-aux_fun-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-use_emi-aux_fun" title="Permalink"></a></h2><p>The are several additional functions which are specific for the individual types. This functions are either used as example for a simplified interface or alternatively required in <code>EnergyModelsInvestments</code>. The latter requires you to implement methods within your model through multiple dispatch as they are called within <code>EnergyModelsInvestments</code>.</p><h3 id="how_to-use_emi-aux_fun-req_met"><a class="docs-heading-anchor" href="#how_to-use_emi-aux_fun-req_met">Required methods</a><a id="how_to-use_emi-aux_fun-req_met-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-use_emi-aux_fun-req_met" title="Permalink"></a></h3><p>When you are using the type <a href="../../library/public/#EnergyModelsInvestments.NoStartInvData"><code>NoStartInvData</code></a>, you have to specify the function</p><pre><code class="language-julia hljs">start_cap(element, t_inv, inv_data::NoStartInvData, cap)</code></pre><p>for your type. The main reason is that in this case you do not specify the initial capacity in <code>EnergyModelsInvestments</code>, but instead deduce it from the provided initial capacity in your energiy system optimization model.</p><p>In the case of EnergyModelsBase, this is given through the methods</p><pre><code class="language-julia hljs">EMI.start_cap(n::EMB.Node, t_inv, inv_data::NoStartInvData, cap) =
    capacity(n, t_inv)
EMI.start_cap(n::Storage, t_inv, inv_data::NoStartInvData, cap) =
    capacity(getproperty(n, cap), t_inv)</code></pre><p>and the application of the internal function <code>capacity()</code>.</p><h3 id="how_to-use_emi-aux_fun-sim_int"><a class="docs-heading-anchor" href="#how_to-use_emi-aux_fun-sim_int">Simplified interface functions</a><a id="how_to-use_emi-aux_fun-sim_int-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-use_emi-aux_fun-sim_int" title="Permalink"></a></h3><p><code>EnergyModelsBase</code> creates new types for the investment data instead of using <a href="../../library/public/#EnergyModelsInvestments.NoStartInvData"><code>NoStartInvData</code></a> and <a href="../../library/public/#EnergyModelsInvestments.StartInvData"><code>StartInvData</code></a>. The background for this approach is that we like to have the potential for multiple capacities within a node, <em>e.g.</em>, charge, level, and discharge capacities in <code>Storage</code> nodes as well as the potential for investments in the individual capacities. Hence, we create new methods for the function <a href="../../library/public/#EnergyModelsInvestments.investment_data"><code>investment_data()</code></a> to directly access the individual fields of the new investment data types from the node level. In addition, we incorporate the function <a href="../../library/public/#EnergyModelsInvestments.has_investment"><code>has_investment()</code></a> to allow a limitation of investments to a subset of the nodes.</p><p>Both functions are not directly used in <code>EnergyModelsInvestments</code> in this context. Hence, it is not required to declare new methods for these functions. It can however be beneficial to create methods as it may simplify the subsequent structure.</p><h2 id="how_to-use_emi-var_dec"><a class="docs-heading-anchor" href="#how_to-use_emi-var_dec">Variable declarations</a><a id="how_to-use_emi-var_dec-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-use_emi-var_dec" title="Permalink"></a></h2><p>As outlined in <em><a href="../../manual/optimization-variables/#man-opt_var">Optimization variables</a></em>, we require that the user follows a given variable naming convention. The variables used within <code>EnergyModelsInvestments</code> are extracted with the help of the following functions:</p><ul><li><a href="../../library/internals/#EnergyModelsInvestments.get_var_capex-Tuple{Any, Symbol, Any}"><code>EMI.get_var_capex</code></a> for capital expenses variables, declared over strategic periods,</li><li><a href="../../library/internals/#EnergyModelsInvestments.get_var_inst-Tuple{Any, Symbol, Any}"><code>EMI.get_var_inst</code></a> for capacity variables, declared over operational periods,</li><li><a href="../../library/internals/#EnergyModelsInvestments.get_var_current-Tuple{Any, Symbol, Any}"><code>EMI.get_var_current</code></a> for capacity variables, declared over strategic periods,</li><li><a href="../../library/internals/#EnergyModelsInvestments.get_var_add-Tuple{Any, Symbol, Any}"><code>EMI.get_var_add</code></a> for capacity addtion variables, declared over strategic periods,</li><li><a href="../../library/internals/#EnergyModelsInvestments.get_var_rem-Tuple{Any, Symbol, Any}"><code>EMI.get_var_rem</code></a> for capacity removal variables, declared over strategic periods,</li><li><a href="../../library/internals/#EnergyModelsInvestments.get_var_invest_b-Tuple{Any, Symbol, Any}"><code>EMI.get_var_invest_b</code></a> for helper variables for investments, declared over strategic periods, and</li><li><a href="../../library/internals/#EnergyModelsInvestments.get_var_remove_b-Tuple{Any, Symbol, Any}"><code>EMI.get_var_remove_b</code></a> for helper variables for removals, declared over strategic periods.</li></ul><p>The provided functions utilize a <code>prefix::Symbol</code> argument which is the corresponding prefix for all variables. <em><a href="../../manual/optimization-variables/#man-opt_var">Optimization variables</a></em> explains the required names for the variables with <code>prefix = :cap</code>.</p><p>Although it is in general possible to provide dispatch on these functions for new types, we unfortunately require in the current implementation that the naming convention has to be followed at least for the <em><a href="../../manual/optimization-variables/#man-opt_var-aux">Auxiliary variables</a></em> as <a href="https://github.com/sintefore/SparseVariables.jl"><code>SparseVariables</code></a> requires the extraction of all variables with a given name before the insertion.</p><p>Hence, it is best to declare all variables as, <em>e.g.</em> using the prefix <code>:cap</code>:</p><pre><code class="language-julia hljs">ğ’¯á´µâ¿áµ› = strategic_periods(ğ’¯)

# Add investment variables for reference nodes for each strategic period:
@variable(m, cap_inst[ğ’©á´µâ¿áµ›] &gt;= 0)
@variable(m, cap_capex[ğ’©á´µâ¿áµ›, ğ’¯á´µâ¿áµ›] &gt;= 0)
@variable(m, cap_current[ğ’©á´µâ¿áµ›, ğ’¯á´µâ¿áµ›] &gt;= 0)
@variable(m, cap_add[ğ’©á´µâ¿áµ›, ğ’¯á´µâ¿áµ›] &gt;= 0)
@variable(m, cap_rem[ğ’©á´µâ¿áµ›, ğ’¯á´µâ¿áµ›] &gt;= 0)
@variable(m, cap_invest_b[ğ’©á´µâ¿áµ›, ğ’¯á´µâ¿áµ›] &gt;= 0; container = IndexedVarArray)
@variable(m, cap_remove_b[ğ’©á´µâ¿áµ›, ğ’¯á´µâ¿áµ›] &gt;= 0; container = IndexedVarArray)</code></pre><p>with <code>ğ’©á´µâ¿áµ›</code> corresponding to nodes with investments.</p><h2 id="how_to-use_emi-inc_inv"><a class="docs-heading-anchor" href="#how_to-use_emi-inc_inv">Inclusion of investment constraints</a><a id="how_to-use_emi-inc_inv-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-use_emi-inc_inv" title="Permalink"></a></h2><p>Investment constraints are included through the function</p><pre><code class="language-julia hljs">function add_investment_constraints(
    m,                          # JuMP model
    element,                    # Element for which investments are added
    inv_data::AbstractInvData,  # Investment data for the element
    cap,                        # Capacity that has investments
    prefix,                     # Used prefix in variable declaration
    ğ’¯á´µâ¿áµ›::TS.StratPeriods,      # Strategic periods
    disc_rate::Float64,         # Discount rate in absolute values
)</code></pre><p>The individual input is as well described in the <a href="../../library/internals/#EnergyModelsInvestments.add_investment_constraints-Tuple{Any, Any, AbstractInvData, Any, Any, TimeStruct.StratPeriods, Float64}">documentation</a></p><p>This functions includes constraints on the capacity and calculates the capital expenses for each <code>element</code>. There are two main points one has to consider:</p><ol><li>We add the investments constraints for each individual <code>element</code>. In the case of multiple <code>element</code>s, it is necessary to iterate through the vector of <code>element</code>s.</li><li>We add the investment constraints for each individual capacity <code>cap</code>. This argument is only relevant if an <code>element</code> has multiple capacities as it is the case for <code>Storage</code> nodes in <code>EnergyModelsBase</code>.</li></ol><p>Consequently, you have to iterate through all <code>element</code>s and their capacities <code>cap</code> if you want to add investment constraints.</p><p>Given the example nodes above with single capacities, this would be given as:</p><pre><code class="language-julia hljs">for n âˆˆ ğ’©á´µâ¿áµ›
    # Extract the investment data, the discount rate, and the strategic periods
    disc_rate = discount_rate(modeltype)
    inv_data = investment_data(n, :cap)
    ğ’¯á´µâ¿áµ› = strategic_periods(ğ’¯)

    # Add the investment constraints
    EMI.add_investment_constraints(m, n, inv_data, :cap, :cap, ğ’¯á´µâ¿áµ›, disc_rate)
end</code></pre><p>Note that we included in this example a method for <code>investment_data()</code> as outlined above.</p><h2 id="how_to-use_emi-up_obj"><a class="docs-heading-anchor" href="#how_to-use_emi-up_obj">Updating the objective function</a><a id="how_to-use_emi-up_obj-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-use_emi-up_obj" title="Permalink"></a></h2><p><code>EnergyModelsInvestments</code> does not change the objective function. This would require detailed knowledge regarding the individual contributing factors. Hence, we decided that it is beneficial to instead calculate the capital expense contributions in each strategic period. As a consequence, when using <code>EnergyModelsInvestments</code>, you have to include the variable <span>$\texttt{cap\_capex}$</span> (if you used <code>prefix = :cap</code>) for all elements with investments to your objective function.</p><p>An illustrative example is given in the function <code>EMB.objective(m, ğ’©, ğ’¯, ğ’«, modeltype::AbstractInvestmentModel)</code> compared to the function <code>objective(m, ğ’©, ğ’¯, ğ’«, modeltype::EnergyModel)</code> in <code>EnergyModelsBase</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We plan to add the links to the functions once we have both updates registered.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../update-models/">Â« Update models</a><a class="docs-footer-nextpage" href="../contribute/">Contribute to EnergyModelsInvestments Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 20 August 2024 11:45">Tuesday 20 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
